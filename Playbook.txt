---
- name: Configure Inventory
  hosts: localhost
  become: yes
  tasks:
    - name: Create inventory
      file:
        path: /opt/ansible/hosts
        state: touch

    - name: Add OS Hosts
      add_host:
        hostname: '{{ item.hostname }}'
        groups: '{{ item.groups }}'
        ansible_ssh_port: 22
        ansible_ssh_private_key_file: /opt/keys/'{{ item.hostname }}'.key
      hostname:
      - alt
      - astra
      - redos
      groups:
      - ALT
      - ASTRA
      - REDOS

    - name: Add Servers Hosts
      add_host:
        hostname: '{{ item.hostname }}'
        groups: "Servers:children"
      loop:
      - ALT
      - ASTRA
      - REDOS

    - name: Create directory for group_vars
      file:
        path: /opt/ansible/group_vars
        state: directory

    - name: Create config
      file:
        path: /opt/ansible/group_vars/all
        state: touch

    - name: Configure group_vars
      blockinfile:
        path: /opt/ansible/group_vars/all
        block: |
        ansible_user: sshuser
        ansible_host_key_checking: false
        ansible_ssh_private_key_file: /opt/keys/{{ inventory_hostname }}
        ansible_python_interpreter: /usr/bin/python3
      
    - name: Configure inventory server
      lineinfile:
        path: /opt/ansible/hosts
        regexp: #?#inventory.*
        line: inventory = /etc/ansible/hosts
        state: present

    - name: "Config mashines"
      hosts: all
      become: yes
      tasks:
        - name: Test Connection
          ping:

- name: Create directory
  hosts: Servers
  become: yes
  tasks:
    - name: Create directory
      file:
        path: /opt/ansible/project_'{{ item }}'
        state: directory
      loop:
      - 1
      - 2
      - 3
      - 4
      - 5

    - name: Create files
      file:
        path: /opt/ansible/project_'{{ item.directory }}'/playbook_'{{ item.files }}'.yml
        state: directory
      directory:
      - 1
      - 2
      - 3
      - 4
      - 5
      files:
      - 1
      - 2